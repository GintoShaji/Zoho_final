<tbody>
    <tr>
        <td></td>
        <td>
            <div class="d-flex align-items-center">
                <select class="form-control bg-light text-dark mr-2" name="itemname" onchange="updateItemDetails(this)" style="width: 110px;">
                    <option selected>Select item</option>
                    {% for i in item %}
                        <option value="{{ i.id }}">{{ i.item_name }}</option>
                    {% endfor %}
                </select>
                <div class="ml-2">
                    <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="#newpayment" data-toggle="modal" style="color: white; background-color: rgb(210, 132, 30);" >+</a>
                </div>
            </div>
        </td>
        <td><input type="text" class="form-control border-1 bg-light text-dark" id="hsnInput" name="hsn"></td>
        <td><input type="number" class="form-control border-1 bg-light text-dark" name="quantity" onchange="calculateTotal(this); calculateSubtotal()" id="quantity1"></td>
        <td><input type="text" class="form-control border-1 bg-light text-dark" id="priceInput"  name="price" onchange="calculateTotal(this); calculateSubtotal()" id="price1"></td>
        <td><input type="text" class="form-control border-1 bg-light text-dark" id="taxRateInput" name="tax_rate" onclick="sample1()" onchange="calculateTotal(this)" id="taxRate1"></td>
        <td><input type="text" class="form-control border-1 bg-light text-dark" name="discount" onclick="sample()" onchange="calculateTotal(this); calculateSubtotal()" id="discount1"></td>
        <td><input type="text" class="form-control border-1 bg-light text-dark" value="{{ total }}"  name="total" readonly id="total1"></td>
        <td><button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button></td>
    </tr>
</tbody>

<script>
    // Function to calculate and update the subtotal
    function calculateSubtotal() {
        var rows = document.querySelectorAll('tbody tr');
        
        rows.forEach(function(row) {
            var quantity = parseFloat(row.querySelector('input[name="quantity"]').value) || 0;
            var price = parseFloat(row.querySelector('input[name="price"]').value) || 0;
            var discount = parseFloat(row.querySelector('input[name="discount"]').value) || 0;
            
            var subtotal = (quantity * price) - discount;
            row.querySelector('input[name="total"]').value = subtotal.toFixed(2);
        });

        // Calculate total of all subtotals and update the Sub Total input field
        var subTotal = 0;
        rows.forEach(function(row) {
            subTotal += parseFloat(row.querySelector('input[name="total"]').value) || 0;
        });
        document.getElementById('subTotal').value = subTotal.toFixed(2);
    }
</script>



$('document').ready(function () {
    $('.add_another').click(function () {
      $("#tbl").append(`<tr>
        <td></td>

        <td>
            <div class="d-flex align-items-center">
                <select class="form-control bg-light text-dark mr-2" name="itemname" onchange="updateItemDetails(this)" style="width: 110px;">
                    <option selected>Select item</option>
                    {% for i in item %}
                        <option value="{{ i.id }}">{{ i.item_name }}</option>
                    {% endfor %}
                </select>
                <div class="ml-2">
                    <a href="#" class="btn btn-outline-secondary py-2 my-1" data-target="" data-toggle="modal" style="color: white; background-color: rgb(210, 132, 30);" >+</a>
                </div>
            </div>
        </td>

        <td>
            <input type="text" name="hsn" class="form-control border-1 bg-light text-dark" id="hsnInput"  value="" />
        </td>
        <td>
            <input type="number" name="quantity" class="form-control border-1 bg-light text-dark" onchange="calculateTotal(this); calculateSubtotal()" value="" />
        </td>
        <td>
            <input type="text" name="price" class="form-control border-1 bg-light text-dark"  id="priceInput" onchange="calculateTotal(this); calculateSubtotal()" value="" />
        </td>
        <td>
            <input type="text"  onclick="sample1()" name="tax_rate" class="form-control border-1 bg-light text-dark" onchange="calculateTotal(this)"  value="" />
        </td>
        <td>
            <input type="text" onclick="sample()" name="discount" class="form-control border-1 bg-light text-dark" onchange="calculateTotal(this); calculateSubtotal()"  value="" />
        </td>
        <td>
            <input type="text" name="total" class="form-control border-1 bg-light text-dark"  value="{{ total }}"  name="total" readonly value="" />
        </td>
        
        <td><button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button></td>
    </tr>`);
    });
  })


